<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Distribuci√≥n de alojamientos certificados</title>
    <style>
      :root {
        color-scheme: light;
        --bg-color: #f7f9fb;
        --card-bg: #ffffff;
        --text-color: #0f172a;
        --muted-text: #475569;
        --shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      }

      body.dark {
        color-scheme: dark;
        --bg-color: #050816;
        --card-bg: #0f172a;
        --text-color: #e2e8f0;
        --muted-text: #94a3b8;
        --shadow: 0 15px 40px rgba(2, 6, 23, 0.75);
      }

      body {
        font-family: "Inter", "Helvetica Neue", Arial, sans-serif;
        margin: 0;
        padding: 1.25rem 0 1.5rem;
        background: var(--bg-color);
        color: var(--text-color);
        transition: background 0.4s ease, color 0.4s ease;
      }
      header {
        max-width: 960px;
        margin: 0 auto 0.75rem;
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
        gap: 1rem;
      }
      h1 {
        margin: 0 0 0.5rem;
        font-size: 1.9rem;
        color: var(--text-color);
      }
      p {
        margin: 0;
        color: var(--muted-text);
        line-height: 1.5;
      }
      .chart-shell {
        max-width: 960px;
        margin: 0 auto;
        background: var(--card-bg);
        border-radius: 16px;
        padding: 0.5rem 1rem 1.25rem;
        box-shadow: var(--shadow);
        transition: background 0.4s ease, box-shadow 0.4s ease;
        position: relative;
      }

      #container {
        height: 500px;
      }

      .header-text {
        flex: 1;
        min-width: 240px;
      }

      .theme-toggle {
        position: absolute;
        top: 1rem;
        right: 1rem;
        z-index: 5;
        background: var(--card-bg);
        border: 1px solid rgba(148, 163, 184, 0.4);
        border-radius: 999px;
        padding: 0.35rem 0.6rem;
        display: flex;
        align-items: center;
        gap: 0.3rem;
        cursor: pointer;
        font-size: 0.95rem;
        color: var(--text-color);
        box-shadow: var(--shadow);
        transition: background 0.3s ease, transform 0.2s ease, color 0.3s ease;
      }

      .theme-toggle:hover {
        transform: translateY(-1px);
      }

      .theme-toggle .icon {
        font-size: 1.1rem;
        line-height: 1;
      }

      .theme-toggle .moon {
        display: none;
      }

      body.dark .theme-toggle .sun {
        display: none;
      }

      body.dark .theme-toggle .moon {
        display: inline-flex;
      }
    </style>
    <script src="https://code.highcharts.com/highcharts.js"></script>
  </head>
  <body class="light">
    <header>
      <div class="header-text">
        <h1>Distribuci√≥n de tipos de alojamientos certificados</h1>
        <p>
          Los datos provienen del pipeline ETL de <strong>Empresas Certificadas</strong> y
          reflejan el n√∫mero de establecimientos con certificaci√≥n vigente por tipolog√≠a.
        </p>
      </div>
    </header>
    <div class="chart-shell">
      <button id="themeToggle" class="theme-toggle" aria-label="Cambiar a modo oscuro">
        <span class="icon sun" aria-hidden="true">‚òÄÔ∏è</span>
        <span class="icon moon" aria-hidden="true">üåô</span>
      </button>
      <div id="container"></div>
    </div>
    <script>
      const categories = [
        "Caba√±as",
        "Hostal",
        "Hotel",
        "Cama y desayuno / alojamiento familiar",
        "Departamentos Tur√≠sticos y/o Ejecutivos",
        "Residencial",
        "Albergue / refugio",
        "Apartotel",
        "Centro de turismo de naturaleza o ecoalbergue",
        "Hoster√≠a",
        "Hotel boutique",
        "Complejo tur√≠stico o centro vacacional",
        "Estancia o Hacienda"
      ];

      const values = [
        2680,
        1853,
        1574,
        722,
        629,
        510,
        305,
        281,
        235,
        193,
        163,
        124,
        21
      ];

      const shares = [
        0.2665,
        0.1843,
        0.1565,
        0.0718,
        0.0626,
        0.0507,
        0.0303,
        0.0279,
        0.0234,
        0.0192,
        0.0162,
        0.0123,
        0.0021
      ];

      const themes = {
        light: {
          chartBg: 'rgba(255,255,255,0)',
          text: '#0f172a',
          muted: '#475569',
          grid: '#dbeafe',
          tooltipBg: '#ffffff',
          tooltipText: '#0f172a',
          accent: '#2563eb',
          palette: Highcharts.getOptions().colors.map((c) => Highcharts.color(c).brighten(0.1).get())
        },
        dark: {
          chartBg: 'rgba(15,23,42,0.7)',
          text: '#e2e8f0',
          muted: '#94a3b8',
          grid: 'rgba(148,163,184,0.2)',
          tooltipBg: '#0f172a',
          tooltipText: '#f8fafc',
          accent: '#38bdf8',
          palette: ['#60a5fa', '#38bdf8', '#34d399', '#facc15', '#f472b6', '#c084fc', '#f87171', '#fb923c', '#a78bfa', '#4ade80', '#fbbf24', '#f43f5e', '#22d3ee']
        }
      };

      let currentTheme = 'light';
      let chartInstance = null;

      const buildChartOptions = (theme) => ({
        chart: {
          type: 'column',
          backgroundColor: theme.chartBg,
          style: {
            fontFamily: 'Inter, Helvetica Neue, Arial, sans-serif'
          }
        },
        title: {
          text: 'Cantidad de alojamientos certificados por tipo',
          style: { color: theme.text }
        },
        subtitle: {
          text: 'Fuente: ETL Empresas Certificadas',
          style: { color: theme.muted }
        },
        xAxis: {
          categories,
          title: {
            text: 'Tipo de alojamiento',
            style: { color: theme.text }
          },
          labels: {
            style: {
              fontSize: '12px',
              color: theme.muted
            }
          },
          lineColor: theme.grid,
          tickColor: theme.grid,
          crosshair: { color: theme.accent }
        },
        yAxis: {
          min: 0,
          gridLineColor: theme.grid,
          labels: {
            style: { color: theme.muted }
          },
          title: {
            text: 'Empresas certificadas',
            style: { color: theme.text }
          }
        },
        tooltip: {
          backgroundColor: theme.tooltipBg,
          style: { color: theme.tooltipText },
          borderRadius: 8,
          shared: false,
          formatter: function () {
            const pct = (shares[this.point.index] * 100).toFixed(1);
            return `<strong>${this.key}</strong><br/>Empresas certificadas: ${
              Highcharts.numberFormat(this.y, 0, ',', '.')
            }<br/>Participaci√≥n: ${pct}%`;
          }
        },
        plotOptions: {
          column: {
            pointPadding: 0.15,
            borderRadius: 4,
            colorByPoint: true
          }
        },
        colors: theme.palette,
        series: [
          {
            name: 'Empresas certificadas',
            data: values,
            dataLabels: {
              enabled: true,
              format: '{point.y:,.0f}',
              style: {
                fontSize: '11px',
                fontWeight: '600',
                color: theme.text
              }
            }
          }
        ],
        credits: {
          text: 'UACh CER ¬∑ Equipo de Ciencia de Datos',
          href: null,
          style: { color: theme.muted }
        }
      });

      const renderChart = () => {
        const theme = themes[currentTheme];
        if (chartInstance) {
          chartInstance.destroy();
        }
        chartInstance = Highcharts.chart('container', buildChartOptions(theme));
      };

      const toggleButton = document.getElementById('themeToggle');

      toggleButton.addEventListener('click', () => {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.body.classList.toggle('dark', currentTheme === 'dark');
        document.body.classList.toggle('light', currentTheme === 'light');
        toggleButton.setAttribute(
          'aria-label',
          currentTheme === 'light' ? 'Cambiar a modo oscuro' : 'Cambiar a modo claro'
        );
        renderChart();
      });

      renderChart();
    </script>
  </body>
</html>
