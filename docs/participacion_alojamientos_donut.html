<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Participación porcentual de alojamientos certificados</title>
    <style>
      :root {
        color-scheme: light;
        --bg-color: #f8fafc;
        --card-bg: #ffffff;
        --text-color: #0f172a;
        --muted-text: #475569;
        --shadow: 0 14px 45px rgba(15, 23, 42, 0.08);
      }

      body {
        margin: 0;
        padding: 1.25rem 0 1.5rem;
        font-family: "Inter", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
        background: var(--bg-color);
        color: var(--text-color);
        transition: background 0.4s ease, color 0.4s ease;
      }

      #chart-wrapper {
        max-width: 960px;
        margin: 0 auto;
        padding: 1.75rem 1.25rem 1.5rem;
        background: var(--card-bg);
        border-radius: 18px;
        box-shadow: var(--shadow);
        transition: background 0.4s ease, box-shadow 0.4s ease;
        position: relative;
      }

      .chart-area {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        align-items: center;
      }

      #container {
        flex: 1 1 520px;
        min-width: 320px;
        height: 520px;
      }

      .custom-legend {
        flex: 0 0 220px;
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
        color: var(--text-color);
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        font-size: 0.92rem;
        font-weight: 600;
        letter-spacing: -0.01em;
      }

      .legend-swatch {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.15);
      }

      /* Legend colors already match chart palette so no dark mode overrides needed */
    </style>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
  </head>
  <body>
    <div id="chart-wrapper">
      <div class="chart-area">
        <div id="container"></div>
        <div class="custom-legend" id="legend" aria-label="Simbología de tipologías"></div>
      </div>
    </div>
    <script>
      const categories = [
        "Cabañas",
        "Hostal",
        "Hotel",
        "Cama y desayuno / alojamiento familiar",
        "Departamentos Turísticos y/o Ejecutivos",
        "Residencial",
        "Albergue / refugio",
        "Apartotel",
        "Centro de turismo de naturaleza o ecoalbergue",
        "Hostería"
      ];

      const values = [2680, 1853, 1574, 722, 629, 510, 305, 281, 235, 193];

      const shares = [
        0.2665,
        0.1843,
        0.1565,
        0.0718,
        0.0626,
        0.0507,
        0.0303,
        0.0279,
        0.0234,
        0.0192
      ];

      const seriesData = categories.map((name, idx) => ({
        name,
        y: values[idx],
        colorValue: shares[idx]
      }));

      const legendElement = document.getElementById('legend');

      const chartTheme = {
        bg: 'rgba(255,255,255,0)',
        text: '#0f172a',
        muted: '#475569',
        tooltipBg: '#ffffff',
        tooltipText: '#0f172a',
        labelColor: '#0f172a',
        palette: [
          '#2563eb',
          '#0ea5e9',
          '#22d3ee',
          '#14b8a6',
          '#a855f7',
          '#f97316',
          '#facc15',
          '#fb7185',
          '#4ade80',
          '#94a3b8'
        ]
      };

      const positionExportButton = (chart) => {
        if (!chart || !chart.exportSVGElements || !chart.exportSVGElements[0]) {
          return;
        }
        const button = chart.exportSVGElements[0];
        const bbox = button.getBBox();
        const targetX = chart.chartWidth - bbox.width - 12;
        const targetY = 8;
        button.translate(targetX - button.x, targetY - button.y);
      };

      let chartInstance = null;

      const renderLegend = (theme) => {
        if (!legendElement) return;
        const fragment = document.createDocumentFragment();
        categories.forEach((name, idx) => {
          const item = document.createElement('div');
          item.className = 'legend-item';

          const swatch = document.createElement('span');
          swatch.className = 'legend-swatch';
          swatch.style.backgroundColor = theme.palette[idx % theme.palette.length];

          const label = document.createElement('span');
          label.textContent = name;

          item.appendChild(swatch);
          item.appendChild(label);
          fragment.appendChild(item);
        });

        legendElement.innerHTML = '';
        legendElement.appendChild(fragment);
      };

      const buildPieOptions = (theme) => ({
        chart: {
          type: 'pie',
          backgroundColor: theme.bg,
          spacingRight: 30,
          style: {
            fontFamily: 'Inter, Helvetica Neue, Arial, sans-serif'
          },
          events: {
            load: function () {
              positionExportButton(this);
            },
            render: function () {
              positionExportButton(this);
            }
          }
        },
        title: { text: null },
        subtitle: { text: null },
        tooltip: {
          backgroundColor: theme.tooltipBg,
          style: { color: theme.tooltipText },
          borderRadius: 10,
          formatter: function () {
            const pct = (this.point.percentage || 0).toFixed(1);
            return `<strong>${this.point.name}</strong><br/>Empresas certificadas: ${
              Highcharts.numberFormat(this.y, 0, ',', '.')
            }<br/>Participación: ${pct}%`;
          }
        },
        plotOptions: {
          pie: {
            innerSize: '45%',
            borderWidth: 0,
            colors: theme.palette,
            allowPointSelect: true,
            dataLabels: {
              enabled: false
            }
          }
        },
        series: [
          {
            name: 'Empresas certificadas',
            data: seriesData.map((item, idx) => ({
              ...item,
              color: theme.palette[idx % theme.palette.length]
            }))
          }
        ],
        credits: {
          text: 'UACh CER · Equipo de Ciencia de Datos',
          href: null,
          style: { color: theme.muted }
        },
        exporting: {
          enabled: true,
          buttons: {
            contextButton: {
              symbolStroke: '#475569',
              align: 'right',
              verticalAlign: 'top',
              x: -10,
              y: 0
            }
          }
        },
        exportData: {
          tableCaption: 'Datos exportados'
        }
      });

      const renderPieChart = () => {
        if (chartInstance) {
          chartInstance.destroy();
        }
        chartInstance = Highcharts.chart('container', buildPieOptions(chartTheme));
        renderLegend(chartTheme);
      };

      renderPieChart();
    </script>
  </body>
</html>
